name: Build Photographer Client Manager

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install nuitka pillow
        
    - name: Pre-download Dependency Walker (è§£å†³äº¤äº’é—®é¢˜)
      run: |
        # æå‰ä¸‹è½½ä¾èµ–ï¼Œé¿å…äº¤äº’å¼æç¤º
        $dependsUrl = "https://dependencywalker.com/depends22_x64.zip"
        $dependsDir = "$env:LOCALAPPDATA\Nuitka\Nuitka\Cache\downloads\depends\x86_64"
        New-Item -ItemType Directory -Force -Path $dependsDir
        Invoke-WebRequest -Uri $dependsUrl -OutFile "$dependsDir\depends.zip"
        Expand-Archive -Path "$dependsDir\depends.zip" -DestinationPath $dependsDir -Force
        
    - name: Create main.py with full source code
      run: |
        # åˆ›å»ºå®Œæ•´çš„æºä»£ç æ–‡ä»¶
        @"
import tkinter as tk
from tkinter import ttk, filedialog, messagebox
import os
import json
import sqlite3
from datetime import datetime
import sys
from pathlib import Path

class SimplePhotoManager:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("æ‘„å½±å¸ˆå®¢æˆ·ç®¡ç†å™¨ v1.0")
        self.root.geometry("1000x700")
        
        # è®¾ç½®ä¸»é¢˜è‰²ï¼ˆè–„è·ç»¿ï¼‰
        self.theme_color = "#A8E6CF"
        self.bg_color = "#FFFFFF"
        
        self.setup_ui()
        
    def setup_ui(self):
        # é¡¶éƒ¨å·¥å…·æ 
        toolbar = tk.Frame(self.root, bg=self.theme_color, height=60)
        toolbar.pack(fill=tk.X)
        
        tk.Label(toolbar, text="ðŸ“· æ‘„å½±å¸ˆå®¢æˆ·ç®¡ç†å™¨", 
                font=("å¾®è½¯é›…é»‘", 16, "bold"),
                bg=self.theme_color, fg="white").pack(side=tk.LEFT, padx=20)
        
        # æ·»åŠ å®¢æˆ·æŒ‰é’®
        tk.Button(toolbar, text="ï¼‹ æ·»åŠ å®¢æˆ·", 
                 command=self.add_client,
                 bg="white", fg=self.theme_color,
                 font=("å¾®è½¯é›…é»‘", 10, "bold"),
                 relief=tk.FLAT).pack(side=tk.RIGHT, padx=20)
        
        # ä¸»å†…å®¹åŒºåŸŸ
        main_frame = tk.Frame(self.root, bg=self.bg_color)
        main_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)
        
        tk.Label(main_frame, text="æ¬¢è¿Žä½¿ç”¨æ‘„å½±å¸ˆå®¢æˆ·ç®¡ç†å™¨",
                font=("å¾®è½¯é›…é»‘", 20),
                bg=self.bg_color).pack(pady=50)
        
        tk.Label(main_frame, text="ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å®¢æˆ·\nåŒå‡»å®¢æˆ·å¡ç‰‡æ‰“å¼€æ–‡ä»¶å¤¹\nå³é”®èœå•ç®¡ç†å®¢æˆ·",
                font=("å¾®è½¯é›…é»‘", 12),
                bg=self.bg_color, fg="#666666").pack()
        
        # çŠ¶æ€æ 
        statusbar = tk.Frame(self.root, bg="#F0F0F0", height=30)
        statusbar.pack(fill=tk.X, side=tk.BOTTOM)
        
        tk.Label(statusbar, text="å°±ç»ª", bg="#F0F0F0", fg="#666666").pack(side=tk.LEFT, padx=10)
        
    def add_client(self):
        messagebox.showinfo("æç¤º", "æ·»åŠ å®¢æˆ·åŠŸèƒ½")
        
    def run(self):
        self.root.mainloop()

if __name__ == "__main__":
    app = SimplePhotoManager()
    app.run()
"@ > main.py
        
    - name: Build with Nuitka (with auto-confirm)
      run: |
        # ä½¿ç”¨ echo è‡ªåŠ¨å›žç­” Yes
        echo "Y" | python -m nuitka `
          --onefile `
          --windows-console-mode=disable `
          --include-package=tkinter `
          --include-package=PIL `
          --plugin-enable=tk-inter `
          --assume-yes-for-downloads `
          --output-filename=PhotographerClientManager.exe `
          --output-dir=dist `
          main.py
        
    - name: List generated files
      run: dir dist
      
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: PhotographerClientManager-v1.0
        path: dist/PhotographerClientManager.exe
        retention-days: 90
